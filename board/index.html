<!-- 게시판 head -->
<head>
    <meta charset="UTF-8">
    <title>자유 게시판</title>
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <style>
        /* 기존 스타일 그대로 유지 */
    </style>
</head>

<!-- body ... 기존 HTML 그대로 -->

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<script>
    // ================== Supabase 초기화 ==================
    if(!window.sb){
        const SUPABASE_URL = "https://lpgcfyisclihwlvlxent.supabase.co";
        const SUPABASE_KEY = "sb_publishable_ftA0tc3gS_v48aDVFFpF3g_velgD4y9";
        window.sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    }

    const postsDiv = document.getElementById('posts');

    // ================== 게시글 불러오기 ==================
    async function loadPosts() {
        const { data, error } = await sb
            .from('board_posts')
            .select('*')
            .order('created_at', { ascending: false });

        if(error){
            console.error(error);
            postsDiv.innerHTML = "<p>게시글 불러오기 실패</p>";
            return;
        }

        postsDiv.innerHTML = '';
        data.forEach(post => {
            const div = document.createElement('div');
            div.className = 'post';
            div.innerHTML = `
                <strong>${post.name}</strong> · <span class="date">${new Date(post.created_at).toLocaleString()}</span>
                <div>${post.text}</div>
            `;
            postsDiv.appendChild(div);
        });
    }

    // ================== 게시글 등록 ==================
    document.getElementById('addPostBtn').onclick = async () => {
        const username = document.getElementById('username').value.trim();
        const content = document.getElementById('content').value.trim();

        if (!username) { alert('이름을 입력해주세요!'); return; }
        if (!content) { alert('내용 좀 써라 ㅋㅋ'); return; }

        const { error } = await sb
            .from('board_posts')
            .insert([{ name: username, text: content }]);

        if(error){
            console.error(error);
            alert("게시글 등록 실패");
            return;
        }

        document.getElementById('username').value = '';
        document.getElementById('content').value = '';
        loadPosts();
    };

    // ================== 메인으로 돌아가기 ==================
    document.getElementById('backBtn').onclick = () => {
        window.location.href = "https://kwakkyungmok-del.github.io/my-web-game/";
    };

    // 초기 로드
    loadPosts();
</script>
