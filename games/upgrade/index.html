<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë¬´ê¸° ê°•í™” ì‹œë®¬ë ˆì´í„°</title>
<style>
body { margin:0; padding:0; background:#111; color:#fff; font-family:Arial; display:flex; justify-content:center; align-items:center; height:100vh; }
#backBtn { position:fixed; top:10px; left:10px; padding:8px 12px; background:#333; color:#fff; border:none; border-radius:6px; cursor:pointer; }
.box { width:320px; background:#1a1a1a; padding:20px; border-radius:12px; text-align:center; transition: transform 0.1s, background 0.1s; }
button { width:100%; padding:10px; margin:6px 0; border:none; border-radius:8px; font-size:14px; cursor:pointer;}
#upgradeBtn { background:#3b82f6; color:white; }
#sellBtn { background:#f59e0b; color:black; }
#attendanceBtn { background:#16a34a; color:white; }
#rescueBtn { background:#dc2626; color:white; }
    <div class="box">
    ...
    <button id="devBtn" style="display:none;">ê°œë°œì ì „ìš©</button>
    <div class="devSection" style="display:none; margin-top:10px;">
    <button id="addGoldBtn" style="background:#facc15; color:#000;">ğŸ’° ê³¨ë“œ +1000</button>
    <button id="toggleProtectBtn" style="background:#ef4444; color:#fff;">ğŸ›¡ï¸ íŒŒê´´ ë°©ì§€ OFF</button>
    <button id="upgrade10Btn" style="background:#3b82f6; color:#fff;">âš¡ 10ê°• í•œ ë²ˆì—</button>
</div>

</div>

#gold { color:#facc15; margin:6px 0; font-weight:bold; }
#rate { color:#60a5fa; margin:4px 0; font-size:13px; }
#log { min-height:24px; margin:10px 0; color:#facc15; }
#artisanMsg { margin-bottom:10px; color:#34d399; font-weight:bold; }
.collection { max-height:120px; overflow-y:auto; background:#0f0f0f; padding:6px; border-radius:6px; font-size:12px; margin-top:10px; text-align:left; }
.item { background:#222; margin-bottom:4px; padding:4px; border-radius:4px; }

/* ê¸°ë¡ ë“±ë¡ ëª¨ë‹¬ */
#recordModal {
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; z-index:9999;
}
#recordModal .modalBox {
    background:#1a1a1a; padding:20px; border-radius:12px; width:280px; text-align:center;
}
#recordModal input {
    width:100%; padding:8px; margin:10px 0; border:none; border-radius:6px;
}
#recordModal .saveBtn { background:#f59e0b; color:black; }
#recordModal .closeBtn { background:#333; color:white; }
    .awakening {
    animation: shake 0.2s infinite;
    box-shadow: 0 0 20px 5px red;
    background: linear-gradient(135deg, #3a0000, #000);
}

@keyframes shake {
    0% { transform: translate(0, 0); }
    25% { transform: translate(2px, -2px); }
    50% { transform: translate(-2px, 2px); }
    75% { transform: translate(2px, 2px); }
    100% { transform: translate(0, 0); }
}
    <!-- ì¢Œí•˜ë‹¨ ë¬´ê¸° ë“±ë¡ ë²„íŠ¼ -->
<button id="registerWeaponBtn" style="position:fixed; bottom:10px; left:10px; padding:8px 12px; background:#10b981; color:white; border:none; border-radius:6px; cursor:pointer;">ë¬´ê¸° ë“±ë¡</button>

<!-- ë¬´ê¸° ë“±ë¡ ëª¨ë‹¬ -->
<div id="weaponModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:9999;">
    <div style="background:#1a1a1a; padding:20px; border-radius:12px; width:280px; text-align:center;">
        <h3>ë¬´ê¸° ë“±ë¡</h3>
        <input type="text" id="weaponPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="width:100%; padding:8px; margin:10px 0; border:none; border-radius:6px;">
        <button id="confirmWeaponBtn" style="background:#f59e0b; color:black; width:100%; padding:8px; border:none; border-radius:6px; margin-bottom:6px;">í™•ì¸</button>
        <button id="closeWeaponModalBtn" style="background:#333; color:white; width:100%; padding:8px; border:none; border-radius:6px;">ì·¨ì†Œ</button>
    </div>
</div>


</style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>

<button id="backBtn">â† ë’¤ë¡œê°€ê¸°</button>

<div class="box">
    <div id="artisanMsg">ì¬ë¯¼ì´ ì¸ì‚¬ë¥¼ ê±´ë„µë‹ˆë‹¤â€¦</div>
    <h2 id="weaponName">ë‚¡ì€ ê²€</h2>
    <div id="weaponIcon" style="font-size:48px; margin:6px 0;">ğŸ—¡ï¸</div>
    <div id="weaponLevel">+0</div>
    <div id="rate">ì„±ê³µ í™•ë¥ : 100%</div>
    <div id="gold">ğŸ’° 0 G</div>

    <button id="upgradeBtn">ê°•í™”í•˜ê¸° (20G)</button>
    <button id="sellBtn">ë¬´ê¸° íŒë§¤</button>
    <button id="attendanceBtn">ì¶œì„ ì²´í¬</button>
    <button id="rescueBtn">ê¸´ê¸‰ ì§€ì› ë°›ê¸°</button>
    <button id="openRecordBtn" style="background:#6366f1; color:white;">ê²€ ê¸°ë¡ ë“±ë¡</button>

    <div id="log">ê°•í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</div>

    <div class="collection" id="collection"></div>
</div>

<div id="recordModal">
    <div class="modalBox">
        <h3>ê²€ ê¸°ë¡ ë“±ë¡</h3>
        <input type="text" id="recordName" placeholder="ë‹‰ë„¤ì„ ì…ë ¥">
        <button class="saveBtn" id="saveRecordBtn">ë“±ë¡</button>
        <button class="closeBtn" id="closeRecordBtn">ë‹«ê¸°</button>
    </div>
</div>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* ------------------------- Supabase ì´ˆê¸°í™” ------------------------- */
const SUPABASE_URL = "https://lpgcfyisclihwlvlxent.supabase.co";
const SUPABASE_KEY = "sb_publishable_ftA0tc3gS_v48aDVFFpF3g_velgD4y9";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ------------------------- ë°ì´í„° ì´ˆê¸°í™” ------------------------- */
let level = 0;
let gold = 0;
const upgradeCost = 20;
const stageNames = [
    "ë‚¡ì€",        // 0~4
    "ë‹¨ë‹¨í•œ",      // 5~9
    "ê°•ì² ",        // 10~14
    "ë¶ˆíƒ€ëŠ”",      // 15~19
    "ìš©ì˜",        // 20~24
    "ì‹¬ì—°ì˜",      // 25~29
    "ì²œìƒì˜",      // 30~34
    "ì°¨ì›ì˜",      // 35~39
    "ì‹ í™”ì˜",      // 40~44
    "ì¢…ë§ì˜"       // 45+
];

const extras = [
    "ë‚ ì¹´ë¡œìš´","ë¬µì§í•œ","ë¹›ë‚˜ëŠ”","ì €ì£¼ë°›ì€","ì‹ ì„±í•œ","ê´‘í­í•œ",
    "íŒŒê´´ì ì¸","ëƒ‰í˜¹í•œ","ì ˆëŒ€ì ì¸","í˜¼ëˆì˜","ë¬´í•œì˜","ì¬ì•™ì˜",
    "ì‹¬íŒì˜","ì§€ë°°ìì˜","ë§ê°ì˜","ì´ˆì›”í•œ","ë´‰ì¸ëœ","í­ì£¼ì˜"
];

const artisanGreetings = [
    "ì¢‹ì€ í•˜ë£¨ì…ë‹ˆë‹¤! ê²€ ê°•í™” ì¤€ë¹„ëë‚˜ìš”?",
    "ê°•í™”ë¥¼ ì¦ê¸°ëŸ¬ ì™”êµ°ìš”!",
    "ì˜¤ëŠ˜ë„ ê°•ì² ê°™ì´ ë‹¨ë‹¨í•´ì ¸ ë´…ì‹œë‹¤!",
    "ë¬´ê¸° ê´€ë¦¬ë„ ì¤‘ìš”í•˜ì£ , ì¡°ì‹¬í•˜ì„¸ìš”!",
    "í˜ë‚´ì„¸ìš”! í–‰ìš´ì´ í•¨ê»˜í•˜ê¸¸!",
    "ê°•í™”ëŠ” ë§ˆìŒê°€ì§ë¶€í„° ì‹œì‘ì…ë‹ˆë‹¤."
];

let collectionSet = new Set(JSON.parse(localStorage.getItem("collection") || "[]"));
gold = parseInt(localStorage.getItem("gold") || "1000");
if(!localStorage.getItem("initGold")) { localStorage.setItem("initGold","true"); localStorage.setItem("gold",gold); }

/* ------------------------- ìœ í‹¸ í•¨ìˆ˜ ------------------------- */
function showRandomGreeting(){ document.getElementById("artisanMsg").innerText = `ì¬ë¯¼: "${artisanGreetings[Math.floor(Math.random()*artisanGreetings.length)]}"`; }
function getWeaponName(){
    const stageIndex = Math.floor(level / 5);
    const stage = stageNames[Math.min(stageIndex, stageNames.length - 1)];
    const extra = extras[level % extras.length];

    if (level === 0) return `${stage} ê²€`;
    if (level < 5) return `${stage} ê²€`;
    return `${stage} ${extra} ê²€`;
}
const weaponImages = [
    "https://cdn-icons-png.freepik.com/512/2936/2936546.png",  // ë ˆë²¨ 0~4
    "https://cdn-icons-png.freepik.com/512/9480/9480430.png",   // 5~9
    "https://cdn-icons-png.freepik.com/512/14963/14963311.png", // 10~14
    "https://cdn-icons-png.freepik.com/512/2464/2464414.png",   // 15~19
    "https://cdn-icons-png.freepik.com/512/2464/2464414.png",   // 20~24
    "https://cdn-icons-png.freepik.com/512/1737/1737022.png",   // 25~29
    "https://cdn-icons-png.freepik.com/512/5888/5888890.png",   // 30~34
    "https://cdn-icons-png.freepik.com/512/10612/10612592.png", // 35~39
    "https://cdn-icons-png.freepik.com/512/8194/8194926.png"    // 40+
];

function getWeaponIcon(){ if(level<5) return "ğŸ—¡ï¸"; if(level<10) return "âš”ï¸"; if(level<15) return "ğŸ”¥âš”ï¸"; return "ğŸ‘‘âš”ï¸"; }
function getSuccessRate(){ if(level===0) return 100; let rate = 100; for(let i=1;i<=level;i++){ if(i<=5) rate-=(6-i); else rate-=2; } return Math.max(rate,5); }
function log(msg){ document.getElementById("log").innerText = msg; }
function updateGold(){ document.getElementById("gold").innerText = `ğŸ’° ${gold} G`; localStorage.setItem("gold",gold); }
function addToCollection(name){ if(collectionSet.has(name)) return; collectionSet.add(name); localStorage.setItem("collection",JSON.stringify([...collectionSet])); const div = document.createElement("div"); div.className="item"; div.innerText=name; document.getElementById("collection").appendChild(div); }
function loadCollection(){ const saved=JSON.parse(localStorage.getItem("collection")||"[]"); const box=document.getElementById("collection"); box.innerHTML=""; saved.forEach(n=>{ const div=document.createElement("div"); div.className="item"; div.innerText=n; box.appendChild(div); collectionSet.add(n); }); }

/* ------------------------- í•µì‹¬ ê¸°ëŠ¥ ------------------------- */
function updateWeapon(){ const name=getWeaponName(); document.getElementById("weaponName").innerText=name; document.getElementById("weaponLevel").innerText="+"+level; document.getElementById("rate").innerText=`ì„±ê³µ í™•ë¥ : ${getSuccessRate()}%`;document.getElementById("weaponIcon").innerHTML = `<img src="${getWeaponImage()}" alt="${getWeaponName()}" style="width:48px; height:48px;">`;
 addToCollection(name); }

function upgrade(){
    if(gold < upgradeCost){
        log("ê³¨ë“œ ë¶€ì¡±!");
        return;
    }

    gold -= upgradeCost;
    updateGold();

    const rate = getSuccessRate();
    const rand = Math.random() * 100;
    const box = document.querySelector('.box');

    if(rand <= rate){
        level++;
        log("ê°•í™” ì„±ê³µ! +1");
        showRandomGreeting();

        box.style.transform = "scale(1.05)";
        box.style.background = "#2a2a2a";
        setTimeout(()=>{
            box.style.transform = "scale(1)";
            box.style.background = "#1a1a1a";
        },100);

        if(level >= 55){
            box.classList.add("awakening");
            log("ğŸ’€ ì¢…ë§ì˜ í˜ì´ ê¹¨ì–´ë‚œë‹¤...");
            setTimeout(()=>{ box.classList.remove("awakening"); }, 600);
        }

    } else {
        if(Math.random() < 0.2){
            log("ğŸ’¥ ë¬´ê¸° íŒŒê´´! ìƒˆ ë¬´ê¸° ì§€ê¸‰");
            resetWeapon();
        } else {
            log("ê°•í™” ì‹¤íŒ¨â€¦ ë³€í™” ì—†ìŒ");
        }
    }

    updateWeapon();
}

function resetWeapon(){ level=0; updateWeapon(); }
function sellWeapon(){
    if(level === 0){
        log("ê¸°ë³¸ ë¬´ê¸° íŒë§¤ ë¶ˆê°€");
        return;
    }

    let price = 0;

    if(level === 1) price = 20;
    else if(level === 2) price = 30;
    else if(level === 3) price = 40;
    else if(level === 4) price = 50;
    else {
        // 5ë ˆë²¨ ì´ìƒë¶€í„°ëŠ”: 50 + (ë ˆë²¨-4)*50
        price = 50 + (level - 4) * 50;
    }

    gold += price;
    updateGold();
    log(`+${level} ë¬´ê¸°ë¥¼ ${price}Gì— íŒë§¤`);
    resetWeapon();
}

function checkAttendance(){
    const today = getTodayKey();

    if(localStorage.getItem("attendance") === today){
        log("ì˜¤ëŠ˜ ì¶œì„ ì™„ë£Œ");
        return;
    }

    gold += 1000;
    updateGold();
    localStorage.setItem("attendance", today);
    log("ì¶œì„ ë³´ìƒ 1000G ì§€ê¸‰");
}

function emergencyRescue(){ if(localStorage.getItem("emergencyUsed")==="true"){ log("ì´ë¯¸ ì‚¬ìš©ë¨"); return; } gold+=500; updateGold(); localStorage.setItem("emergencyUsed","true"); log("ğŸ†˜ ê¸´ê¸‰ ì§€ì› 500G ì§€ê¸‰"); checkEmergencyButton(); }
function checkEmergencyButton(){ document.getElementById("rescueBtn").style.display=(localStorage.getItem("emergencyUsed")==="true")?"none":"block"; }
function goBack(){ window.location.href="https://kwakkyungmok-del.github.io/my-web-game/"; }

/* ------------------------- ê¸°ë¡ ë“±ë¡ ------------------------- */
document.getElementById("openRecordBtn").onclick = ()=>{ document.getElementById("recordModal").style.display="flex"; };
document.getElementById("closeRecordBtn").onclick = ()=>{ document.getElementById("recordModal").style.display="none"; };
document.getElementById("saveRecordBtn").onclick = async ()=>{
    const name = document.getElementById("recordName").value.trim();
    if(!name){ alert("ë‹‰ë„¤ì„ ì…ë ¥"); return; }
    const { data, error } = await sb.from('swordRankings').insert([{ owner:name, weapon:getWeaponName(), level:level }]);
    if(error){ alert("ë“±ë¡ ì‹¤íŒ¨:"+error.message); return; }
    alert("ë“±ë¡ ì™„ë£Œ!"); document.getElementById("recordModal").style.display="none"; document.getElementById("recordName").value="";
};

/* ------------------------- ë²„íŠ¼ ì—°ê²° ------------------------- */
document.getElementById("upgradeBtn").addEventListener("click",upgrade);
document.getElementById("sellBtn").addEventListener("click",sellWeapon);
document.getElementById("attendanceBtn").addEventListener("click",checkAttendance);
document.getElementById("rescueBtn").addEventListener("click",emergencyRescue);
document.getElementById("backBtn").addEventListener("click",goBack);

/* ------------------------- ìµœì´ˆ ì‹¤í–‰ ------------------------- */
showRandomGreeting(); updateWeapon(); updateGold(); checkEmergencyButton(); loadCollection();
    function getTodayKey(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return `${y}-${m}-${day}`;
}
    function getWeaponImage(){
    const index = Math.min(Math.floor(level / 5), weaponImages.length - 1);
    return weaponImages[index];
}
let devMode = false;
let protectWeapon = false; // íŒŒê´´ ë°©ì§€ ìƒíƒœ

// í‚¤ ì…ë ¥ ê°ì§€ (ì˜ˆ: Ctrl+Shift+D)
document.addEventListener("keydown", (e)=>{
    if(e.ctrlKey && e.shiftKey && e.key.toLowerCase() === "e"){
        devMode = !devMode;
        document.querySelector(".devSection").style.display = devMode ? "block" : "none";
        alert(devMode ? "ê°œë°œì ëª¨ë“œ í™œì„±í™”!" : "ê°œë°œì ëª¨ë“œ ë¹„í™œì„±í™”!");
    }
});

// ê³¨ë“œ +1000
document.getElementById("addGoldBtn").onclick = ()=>{
    gold += 1000;
    updateGold();
    log("ğŸ’° ê³¨ë“œ 1000 ì¶”ê°€!");
};

// íŒŒê´´ ë°©ì§€ ON/OFF
document.getElementById("toggleProtectBtn").onclick = ()=>{
    protectWeapon = !protectWeapon;
    document.getElementById("toggleProtectBtn").innerText = protectWeapon ? "ğŸ›¡ï¸ íŒŒê´´ ë°©ì§€ ON" : "ğŸ›¡ï¸ íŒŒê´´ ë°©ì§€ OFF";
    log("ğŸ”’ íŒŒê´´ ë°©ì§€ " + (protectWeapon ? "í™œì„±í™”" : "ë¹„í™œì„±í™”"));
};

// 10ê°• í•œë²ˆì—
document.getElementById("upgrade10Btn").onclick = ()=>{
    for(let i=0;i<10;i++){
        const rate = getSuccessRate();
        const rand = Math.random()*100;
        if(rand <= rate){
            level++;
        } else {
            if(!protectWeapon && Math.random() < 0.05){ // íŒŒê´´ ë°©ì§€ ì ìš©
                log("ğŸ’¥ ë¬´ê¸° íŒŒê´´! ìƒˆ ë¬´ê¸° ì§€ê¸‰");
                resetWeapon();
                break;
            }
        }
    }
    updateWeapon();
    log("âš¡ 10ê°• ì‹œë„ ì™„ë£Œ!");
};

// ê¸°ì¡´ upgrade í•¨ìˆ˜ ìˆ˜ì • (íŒŒê´´ ë°©ì§€ ë°˜ì˜)
function upgrade(){
    if(gold < upgradeCost){
        log("ê³¨ë“œ ë¶€ì¡±!");
        return;
    }

    gold -= upgradeCost;
    updateGold();

    const rate = getSuccessRate();
    const rand = Math.random() * 100;
    const box = document.querySelector('.box');

    if(rand <= rate){
        level++;
        log("ê°•í™” ì„±ê³µ! +1");
        showRandomGreeting();

        box.style.transform = "scale(1.05)";
        box.style.background = "#2a2a2a";
        setTimeout(()=>{
            box.style.transform = "scale(1)";
            box.style.background = "#1a1a1a";
        },100);

        if(level >= 55){
            box.classList.add("awakening");
            log("ğŸ’€ ì¢…ë§ì˜ í˜ì´ ê¹¨ì–´ë‚œë‹¤...");
            setTimeout(()=>{ box.classList.remove("awakening"); }, 600);
        }

    } else {
        if(!protectWeapon && Math.random() < 0.05){
            log("ğŸ’¥ ë¬´ê¸° íŒŒê´´! ìƒˆ ë¬´ê¸° ì§€ê¸‰");
            resetWeapon();
        } else {
            log("ê°•í™” ì‹¤íŒ¨â€¦ ë³€í™” ì—†ìŒ");
        }
    }

    updateWeapon();
}
// ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
document.getElementById("registerWeaponBtn").onclick = () => {
    document.getElementById("weaponModal").style.display = "flex";
};
document.getElementById("closeWeaponModalBtn").onclick = () => {
    document.getElementById("weaponModal").style.display = "none";
};

// ë¬´ê¸° ë“±ë¡ í™•ì¸ ë²„íŠ¼
document.getElementById("confirmWeaponBtn").onclick = async () => {
    const password = document.getElementById("weaponPassword").value.trim();
    if (!password) { alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }

    const weaponName = getWeaponName(); // ê¸°ì¡´ í•¨ìˆ˜ ì‚¬ìš©
    const weaponLevel = level;

    try {
        const { data, error } = await sb.from('weapons').insert([{
            owner: 'guest', // ë¡œê·¸ì¸ ì—†ìœ¼ë¯€ë¡œ ì¼ë‹¨ 'guest'ë¡œ ê³ ì •
            name: weaponName,
            level: weaponLevel,
            password: password
        }]);
        if (error) throw error;

        alert("ë¬´ê¸° ë“±ë¡ ì™„ë£Œ!");
        document.getElementById("weaponModal").style.display = "none";
        document.getElementById("weaponPassword").value = "";
    } catch (err) {
        alert("ë“±ë¡ ì‹¤íŒ¨: " + err.message);
    }
};

document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("registerWeaponBtn").onclick = () => {
        document.getElementById("weaponModal").style.display = "flex";
    };

    document.getElementById("closeWeaponModalBtn").onclick = () => {
        document.getElementById("weaponModal").style.display = "none";
    };

    document.getElementById("confirmWeaponBtn").onclick = async () => {
        const password = document.getElementById("weaponPassword").value.trim();
        if (!password) { alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }

        const weaponName = getWeaponName();
        const weaponLevel = level;

        try {
            const { data, error } = await sb.from('weapons').insert([{
                owner: 'guest',
                name: weaponName,
                level: weaponLevel,
                password: password
            }]);
            if (error) throw error;

            alert("ë¬´ê¸° ë“±ë¡ ì™„ë£Œ!");
            document.getElementById("weaponModal").style.display = "none";
            document.getElementById("weaponPassword").value = "";
        } catch (err) {
            alert("ë“±ë¡ ì‹¤íŒ¨: " + err.message);
        }
    };
});


</script>
</body>
</html>
