<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì¹´ë“œ ì „íˆ¬ ê²Œì„</title>
<style>
body { background:#0f0f0f; color:white; font-family:Arial; text-align:center; margin:0; padding:0;}
h1 { padding:20px;}
#gameArea { display:flex; justify-content:space-around; margin-top:20px;}
.deck { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
.card { width:80px; height:120px; background:#222; border-radius:8px; cursor:pointer; perspective:600px; position:relative;}
.cardInner { width:100%; height:100%; transition: transform 0.5s; transform-style: preserve-3d;}
.card .front, .card .back { position:absolute; width:100%; height:100%; backface-visibility:hidden; display:flex; justify-content:center; align-items:center; flex-direction:column; border-radius:8px;}
.card .front { background:#1c1c1c; font-size:14px; transform:rotateY(180deg);}
.card .back { background:#444; }
.selected { border:2px solid #0a84ff; }
.retired { opacity:0.3; }
#log { margin-top:20px; min-height:30px; }
button { padding:8px 15px; margin:5px; border:none; border-radius:5px; cursor:pointer;}
#ruleBtn { position:fixed; top:20px; right:20px; background:#0a84ff; color:white;}
#backBtn { position:fixed; top:20px; left:20px; background:#ff3b30; color:white;}
#restartBtn { display:none; margin-top:20px; background:#34c759; color:white;}
#ruleUI { display:none; position:fixed; top:60px; left:50%; transform:translateX(-50%); background:#222; color:white; padding:15px; border-radius:8px; z-index:100; }
.cardEffect { position:absolute; font-size:20px; z-index:50; animation:moveEffect 0.7s forwards;}
@keyframes moveEffect { 0% {opacity:1; transform:translate(0,0);} 100% {opacity:0; transform:translate(50px,-50px);} }
</style>
</head>
<body>

<h1>âš”ï¸ ì¹´ë“œ ì „íˆ¬ ê²Œì„</h1>
<div>
<button id="ruleBtn">ê·œì¹™</button>
<button id="backBtn">ë©”ì¸ìœ¼ë¡œ</button>
</div>

<div id="ruleUI">
<p>ì¹´ë“œ ì†ì„±: ë¶ˆğŸ”¥ > í’€ğŸŒ¿ > ë¬¼ğŸ’§ > ë•…ğŸŒ > ì² âš™ï¸ > ë…¸ë§âœ¨ > ë¶ˆğŸ”¥</p>
<p>ê³µê²©ë ¥ - ìƒëŒ€ HP ê°ì†Œ, ë°©ì–´ë ¥ ì ìš©</p>
<p>ì¹´ë“œ 5ì¥ ì†Œì§„ ì‹œ íŒ¨ë°°</p>
</div>

<div id="gameArea">
    <div>
        <h3>ë‚´ ë±</h3>
        <div id="playerDeck" class="deck"></div>
    </div>
    <div>
        <h3>ìƒëŒ€ ë±</h3>
        <div id="compDeck" class="deck"></div>
    </div>
</div>

<div id="log"></div>
<button id="restartBtn">ë‹¤ì‹œ ì‹œì‘</button>

<script>
// ì¹´ë“œ ì •ì˜
const allCards = [
  {name:"ë„ì ", emoji:"ğŸ§¥", attr:"ë…¸ë§", atk:5, def:2, hp:10},
  {name:"ë“œë˜ê³¤", emoji:"ğŸ²", attr:"ë¶ˆ", atk:8, def:4, hp:12},
  {name:"ë‹Œì", emoji:"ğŸ¥·", attr:"í’€", atk:6, def:3, hp:11},
  {name:"ê¸°ì‚¬", emoji:"ğŸ›¡ï¸", attr:"ì² ", atk:7, def:5, hp:13},
  {name:"ë§ˆë²•ì‚¬", emoji:"ğŸ§™", attr:"ë¬¼", atk:6, def:2, hp:10},
  {name:"ê±°ì¸", emoji:"ğŸ¦¶", attr:"ë•…", atk:7, def:3, hp:12},
  {name:"ì •ë ¹", emoji:"ğŸ§š", attr:"ë…¸ë§", atk:5, def:4, hp:11},
  {name:"ì•¼ìˆ˜", emoji:"ğŸº", attr:"ë¶ˆ", atk:6, def:2, hp:10},
  {name:"ê¶ìˆ˜", emoji:"ğŸ¹", attr:"í’€", atk:5, def:3, hp:11},
  {name:"ë„ê¹¨ë¹„", emoji:"ğŸ‘¹", attr:"ë•…", atk:7, def:4, hp:12},
  {name:"ê¸°ì‚¬2", emoji:"ğŸ›¡ï¸", attr:"ì² ", atk:6, def:5, hp:11},
  {name:"ë“œë˜ê³¤2", emoji:"ğŸ²", attr:"ë¶ˆ", atk:7, def:3, hp:12},
  {name:"ë‹Œì2", emoji:"ğŸ¥·", attr:"í’€", atk:6, def:2, hp:10},
  {name:"ë§ˆë²•ì‚¬2", emoji:"ğŸ§™", attr:"ë¬¼", atk:5, def:3, hp:11},
  {name:"ê±°ì¸2", emoji:"ğŸ¦¶", attr:"ë•…", atk:7, def:4, hp:12},
  {name:"ì •ë ¹2", emoji:"ğŸ§š", attr:"ë…¸ë§", atk:5, def:2, hp:10},
  {name:"ì•¼ìˆ˜2", emoji:"ğŸº", attr:"ë¶ˆ", atk:6, def:3, hp:11},
  {name:"ê¶ìˆ˜2", emoji:"ğŸ¹", attr:"í’€", atk:5, def:4, hp:12},
  {name:"ë„ê¹¨ë¹„2", emoji:"ğŸ‘¹", attr:"ë•…", atk:7, def:3, hp:11},
  {name:"ê¸°ì‚¬3", emoji:"ğŸ›¡ï¸", attr:"ì² ", atk:6, def:4, hp:12}
];

let playerDeck=[], compDeck=[];
let selectedPlayer=null, selectedComp=null;
let battleStarted=false;

// ìœ í‹¸: ì†ì„± ìŠ¹ë¦¬ ê³„ì‚°
function getMultiplier(att,def){ 
    const winMap={ "ë¶ˆ":"í’€","í’€":"ë¬¼","ë¬¼":"ë¶ˆ","ë•…":"ì² ","ì² ":"ë…¸ë§","ë…¸ë§":"ë¶ˆ"}; 
    return winMap[att]===def ? 2 : (winMap[def]===att ? 0.5 :1);
}

function shuffle(array){ return array.sort(()=>Math.random()-0.5);}

// ê²Œì„ ì‹œì‘
function initGame(){
    playerDeck=[]; compDeck=[];
    selectedPlayer=null; selectedComp=null;
    battleStarted=false;
    document.getElementById('restartBtn').style.display='none';
    
    // 5ì¥ ëœë¤
    let pool=[...allCards]; shuffle(pool);
    playerDeck=pool.splice(0,5); compDeck=pool.splice(0,5);
    renderDecks(true);
    log("ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
}

// ì¹´ë“œ ë Œë”ë§
function renderDecks(showFront=true){
    const playerDiv=document.getElementById('playerDeck');
    const compDiv=document.getElementById('compDeck');
    playerDiv.innerHTML=''; compDiv.innerHTML='';
    
    playerDeck.forEach((c,i)=>{
        const div=document.createElement('div');
        div.className='card'; if(selectedPlayer===i) div.classList.add('selected');
        const inner=document.createElement('div'); inner.className='cardInner'; 
        inner.style.transform=showFront?'rotateY(180deg)':'rotateY(0deg)';
        const front=document.createElement('div'); front.className='front'; front.innerHTML=`${c.emoji}<br>${c.name}<br>${c.attr}<br>HP:${c.hp}`;
        const back=document.createElement('div'); back.className='back'; back.innerHTML='';
        inner.appendChild(front); inner.appendChild(back);
        div.appendChild(inner);
        if(c.hp<=0) div.classList.add('retired');
        div.onclick=()=>{if(!battleStarted) { selectedPlayer=i; log("ê³µê²©í•  ìƒëŒ€ ì¹´ë“œ ì„ íƒ"); } else if(selectedPlayer===i) log("ì´ ì¹´ë“œë¡œ ì´ë¯¸ ê³µê²©ì¤‘"); };
        playerDiv.appendChild(div);
    });

    compDeck.forEach((c,i)=>{
        const div=document.createElement('div');
        div.className='card';
        const inner=document.createElement('div'); inner.className='cardInner';
        inner.style.transform='rotateY(180deg)'; // í•­ìƒ ì•ë©´
        const front=document.createElement('div'); front.className='front'; front.innerHTML=`${c.emoji}<br>${c.name}<br>${c.attr}<br>HP:${c.hp}`;
        const back=document.createElement('div'); back.className='back'; back.innerHTML='';
        inner.appendChild(front); inner.appendChild(back);
        div.appendChild(inner);
        if(c.hp<=0) div.classList.add('retired');
        div.onclick=()=>{if(selectedPlayer!==null && battleStarted) attack(i);};
        compDiv.appendChild(div);
    });
}

// ë¡œê·¸ ì¶œë ¥
function log(txt){ document.getElementById('log').textContent=txt; }

// ê³µê²©
function attack(compIdx){
    if(selectedPlayer===null) return;
    battleStarted=true;
    const p=playerDeck[selectedPlayer];
    const c=compDeck[compIdx];
    
    // í”Œë ˆì´ì–´ ê³µê²©
    let multiplier=getMultiplier(p.attr,c.attr);
    let dmg=Math.max(p.atk - c.def,0)*multiplier;
    c.hp=Math.max(c.hp-dmg,0);
    showEffect(c.emoji,compDeck[compIdx]); // ì´í™íŠ¸
    
    log("ìƒëŒ€ ê³µê²© ì¤‘...");
    
    // ì»´í“¨í„° ê³µê²© (1ì´ˆ í›„)
    setTimeout(()=>{
        const alive=playerDeck.filter(x=>x.hp>0);
        if(alive.length===0){ endGame(false); return; }
        const compCard=compDeck[Math.floor(Math.random()*compDeck.length)];
        const targets=playerDeck.filter(x=>x.hp>0);
        const playerTarget=targets[Math.floor(Math.random()*targets.length)];
        let mult=getMultiplier(compCard.attr,playerTarget.attr);
        let dmg2=Math.max(compCard.atk - playerTarget.def,0)*mult;
        playerTarget.hp=Math.max(playerTarget.hp-dmg2,0);
        showEffect(compCard.emoji,playerTarget,true);
        renderDecks(true);
        
        checkEnd();
        selectedPlayer=null;
        battleStarted=false;
        log("ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
    },800);
}

// ì´í™íŠ¸
function showEffect(emoji,target,isPlayer=false){
    const div=document.createElement('div');
    div.className='cardEffect'; div.textContent=emoji;
    document.body.appendChild(div);
    const rect=document.querySelectorAll('.card')[isPlayer?playerDeck.indexOf(target):compDeck.indexOf(target)].getBoundingClientRect();
    div.style.left=rect.left+'px'; div.style.top=rect.top+'px';
    setTimeout(()=>div.remove(),700);
}

// ê²Œì„ ì¢…ë£Œ
function checkEnd(){
    const pAlive=playerDeck.filter(x=>x.hp>0).length;
    const cAlive=compDeck.filter(x=>x.hp>0).length;
    if(pAlive===0) endGame(false);
    else if(cAlive===0) endGame(true);
}

function endGame(win){
    log(win?"ìŠ¹ë¦¬!":"íŒ¨ë°°!");
    document.getElementById('restartBtn').style.display='inline-block';
}

// ë²„íŠ¼ ì´ë²¤íŠ¸
document.getElementById('ruleBtn').onclick=()=>{ const ru=document.getElementById('ruleUI'); ru.style.display=ru.style.display==='none'?'block':'none'; }
document.getElementById('backBtn').onclick=()=>{ window.location.href='../'; }
document.getElementById('restartBtn').onclick=()=>{ initGame(); }

initGame();
</script>

</body>
</html>
