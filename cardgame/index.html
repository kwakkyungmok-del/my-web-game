<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì „ëµ ì†ì„± ì¹´ë“œ ê²Œì„</title>
<style>
body {
    background: #0f0f0f;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
}
h1 { padding: 20px; }

.deckArea {
    margin: 15px;
    display: flex;
    justify-content: center;
    gap: 20px;
}

.deck {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
}

.card {
    width: 100px; height: 140px;
    cursor: pointer;
    position: relative;
    perspective: 600px;
}

.cardInner {
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.5s;
    position: relative;
}

.front, .back {
    position: absolute;
    width: 100%; height: 100%;
    backface-visibility: hidden;
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    font-size: 14px;
    text-align: center;
}

.front {
    background: #1c1c1c;
    transform: rotateY(180deg);
}
.back {
    background: #444;
}

.selected { border: 3px solid #0a84ff; transform: scale(1.15); }
.retired { opacity: 0.3; cursor: default; }

#log { min-height:60px; padding: 10px; }
button { padding: 8px 14px; margin: 5px; border:none; border-radius:5px; cursor:pointer; }

#ruleBtn { position: fixed; top: 20px; right: 20px; background:#0a84ff; color:white; }
#backBtn { position: fixed; top: 20px; left: 20px; background:#ff3b30; color:white; }
#restartBtn { display:none; background:#34c759; color:white; }

#ruleUI {
    display:none; position:fixed;
    top:80px; left:50%; transform:translateX(-50%);
    background:#222; padding:15px;
    border-radius:8px; width:300px;
    font-size:14px; text-align:left;
}
.effect {
    position:absolute; font-size:28px; z-index:100;
    transition: transform 0.7s, opacity 0.7s;
}
</style>
</head>
<body>

<h1>âš”ï¸ ì „ëµ ì†ì„± ì¹´ë“œ ë°°í‹€</h1>
<button id="backBtn">ë©”ì¸ìœ¼ë¡œ</button>
<button id="ruleBtn">ê·œì¹™</button>
<button id="restartBtn">ë‹¤ì‹œ ì‹œì‘</button>

<div id="ruleUI">
    <p><strong>ê²Œì„ ê·œì¹™</strong></p>
    <p>1) ì¹´ë“œ í’€ì—ì„œ 5ì¥ ì„ íƒ â†’ ì „íˆ¬ ì‹œì‘</p>
    <p>2) ì†ì„± ìƒì„±:<br>
       ğŸ”¥ë¶ˆ > ğŸŒ¿í’€ > ğŸ’§ë¬¼ > ğŸ”¥ë¶ˆ</p>
    <p>ê³µê²©ë ¥ - ìƒëŒ€ ë°©ì–´ë ¥ Ã— ìƒì„± ë°°ìœ¨ â†’ HP ê°ì†Œ</p>
    <p>ê³µê²© ì‹œ ìƒëŒ€ë§Œ í”¼í•´(ë‚´ ì¹´ë“œ í”¼í•´ëŠ” í„´ ì¤‘ ì»´í“¨í„° ê³µê²©ì—ì„œë§Œ)</p>
    <p>ìƒëŒ€ 5ì¥ ëª¨ë‘ ë¦¬íƒ€ì´ì–´ ì‹œ ìŠ¹ë¦¬!</p>
</div>

<div id="selectPhase">
    <h3>ì¹´ë“œ í’€ (ë’¤ì§‘íŒ ìƒíƒœ, í´ë¦­í•´ 5ì¥ ì„ íƒ)</h3>
    <div id="cardPool" class="deck"></div>
</div>

<div id="battlePhase" style="display:none;">
    <div class="deckArea">
        <div><h3>ë‚´ ë±</h3><div id="playerDeck" class="deck"></div></div>
        <div><h3>ìƒëŒ€ ë±</h3><div id="compDeck" class="deck"></div></div>
    </div>
</div>

<div id="log"></div>

<script>
// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
// ì¹´ë“œ ë°ì´í„°
const allCards = [
  {name:"ë„ì ", emoji:"ğŸ§¥", attr:"ë…¸ë§", atk:5, def:3, hp:18},
  {name:"ë“œë˜ê³¤", emoji:"ğŸ‰", attr:"ë¶ˆ", atk:8, def:5, hp:25},
  {name:"ë‹Œì", emoji:"ğŸ¥·", attr:"í’€", atk:6, def:4, hp:16},
  {name:"ê¸°ì‚¬", emoji:"ğŸ›¡ï¸", attr:"ì² ", atk:7, def:6, hp:22},
  {name:"ë§ˆë²•ì‚¬", emoji:"ğŸª„", attr:"ë¬¼", atk:5, def:3, hp:18},
  {name:"ê±°ì¸", emoji:"ğŸ‘¹", attr:"ë•…", atk:7, def:4, hp:24},
  {name:"ê¶ìˆ˜", emoji:"ğŸ¹", attr:"í’€", atk:6, def:3, hp:20},
  {name:"ì¢€ë¹„", emoji:"ğŸ§Ÿ", attr:"ë…¸ë§", atk:5, def:2, hp:20},
  {name:"ì—˜í”„", emoji:"ğŸ§", attr:"í’€", atk:6, def:5, hp:21},
  {name:"í•´ì ", emoji:"ğŸ´â€â˜ ï¸", attr:"ë¶ˆ", atk:7, def:3, hp:20},
  {name:"ì„±ì§ì", emoji:"â›ª", attr:"ë¬¼", atk:4, def:6, hp:22},
  {name:"ê±°ì¸2", emoji:"ğŸ—¿", attr:"ë•…", atk:8, def:5, hp:24},
  {name:"ì •ë ¹", emoji:"ğŸ§š", attr:"ë¬¼", atk:6, def:4, hp:19},
  {name:"ì•¼ìˆ˜", emoji:"ğŸº", attr:"ë¶ˆ", atk:6, def:3, hp:19},
  {name:"ë„ê¹¨ë¹„", emoji:"ğŸ‘º", attr:"ë•…", atk:7, def:5, hp:22},
  {name:"ê¸°ì‚¬2", emoji:"ğŸ›¡ï¸", attr:"ì² ", atk:6, def:6, hp:21},
  {name:"ë‹Œì2", emoji:"ğŸ¥·", attr:"í’€", atk:5, def:3, hp:17},
  {name:"ì •ë ¹2", emoji:"ğŸ§š", attr:"ë¬¼", atk:5, def:5, hp:18},
  {name:"ì•¼ìˆ˜2", emoji:"ğŸº", attr:"ë¶ˆ", atk:6, def:4, hp:20},
  {name:"ë“œë˜ê³¤2", emoji:"ğŸ²", attr:"ë¶ˆ", atk:7, def:6, hp:27}
];

let cardPool=[];
let playerDeck=[], compDeck=[];
let selectedPlayerCardIndex=null;

const cardPoolDiv=document.getElementById('cardPool');
const playerDiv=document.getElementById('playerDeck');
const compDiv=document.getElementById('compDeck');
const logDiv=document.getElementById('log');
const restartBtn=document.getElementById('restartBtn');

// ì†ì„± ìƒì„± ê³„ì‚°
function getMultiplier(att,def){
    const wins={ "ë¶ˆ":"í’€","í’€":"ë¬¼","ë¬¼":"ë¶ˆ" };
    if(wins[att]===def) return 1.5;
    if(wins[def]===att) return 0.5;
    return 1;
}

// ë’¤ì§‘íŒ ì¹´ë“œ(ì „ë©´ ìˆ¨ê¹€) ë Œë”
function renderCardPool(){
    cardPoolDiv.innerHTML='';
    cardPool.forEach((c,i)=>{
        const cardEl=document.createElement('div');
        cardEl.className='card';
        const inner=document.createElement('div'); inner.className='cardInner';
        const front=document.createElement('div'); front.className='front';
        const back=document.createElement('div'); back.className='back';
        back.textContent=''; // ì„ íƒ ì „ì—” í…ìŠ¤íŠ¸ ì—†ìŒ
        inner.appendChild(front); inner.appendChild(back);
        cardEl.appendChild(inner);
        cardEl.onclick=()=>selectPoolCard(i);
        cardPoolDiv.appendChild(cardEl);
    });
}

function selectPoolCard(i){
    if(playerDeck.length>=5) return;
    playerDeck.push(cardPool.splice(i,1)[0]);
    renderCardPool();
    log(`ì¹´ë“œ ì„ íƒ: ${playerDeck.length}/5`);
    if(playerDeck.length===5) startBattle();
}

// ì „íˆ¬ ë± ë Œë”
function renderBattleDecks(){
    playerDiv.innerHTML=''; compDiv.innerHTML='';
    playerDeck.forEach((c,idx)=>{
        const cardEl=document.createElement('div');
        cardEl.className='card' + (c.hp<=0? ' retired':'');
        if(idx===selectedPlayerCardIndex) cardEl.classList.add('selected');
        const inner=document.createElement('div'); inner.className='cardInner';
        const front=document.createElement('div'); front.className='front';
        const back=document.createElement('div'); back.className='back';
        front.innerHTML=`${c.emoji}<br>${c.name}<br>${c.attr}<br>HP:${c.hp}`;
        back.innerHTML=``;
        inner.appendChild(front); inner.appendChild(back);
        cardEl.appendChild(inner);
        if(c.hp>0) cardEl.onclick=()=>selectPlayerCard(idx);
        playerDiv.appendChild(cardEl);
    });
    compDeck.forEach((c,idx)=>{
        const cardEl=document.createElement('div');
        cardEl.className='card' + (c.hp<=0? ' retired':'');
        const inner=document.createElement('div'); inner.className='cardInner';
        const front=document.createElement('div'); front.className='front';
        const back=document.createElement('div'); back.className='back';
        front.innerHTML=`${c.emoji}<br>${c.name}<br>${c.attr}<br>HP:${c.hp}`;
        back.innerHTML='';
        inner.appendChild(front); inner.appendChild(back);
        cardEl.appendChild(inner);
        if(c.hp>0) cardEl.onclick=()=>playerAttack(idx);
        compDiv.appendChild(cardEl);
    });
}

function startBattle(){
    cardPoolDiv.parentElement.style.display='none';
    logDiv.textContent='ì „íˆ¬ ì‹œì‘! ê³µê²©í•  ë‚´ ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.';
    // ì»´í“¨í„° 5ì¥ ë¬´ì‘ìœ„
    let pool=[...cardPool,...playerDeck];
    while(compDeck.length<5){
        let r=Math.floor(Math.random()*pool.length);
        compDeck.push(pool.splice(r,1)[0]);
    }
    renderBattleDecks();
}

// í”Œë ˆì´ì–´ ì¹´ë“œ ì„ íƒ
function selectPlayerCard(idx){
    selectedPlayerCardIndex=idx;
    logDiv.textContent=`ê³µê²© ì¹´ë“œ ì„ íƒ: ${playerDeck[idx].name}. ì´ì œ ìƒëŒ€ ì¹´ë“œë¥¼ í´ë¦­í•´ ê³µê²©í•˜ì„¸ìš”.`;
    renderBattleDecks();
}

// í”Œë ˆì´ì–´ ê³µê²©
function playerAttack(compIdx){
    if(selectedPlayerCardIndex===null) return;
    let p=playerDeck[selectedPlayerCardIndex];
    let c=compDeck[compIdx];
    if(p.hp<=0||c.hp<=0) return;

    let mult=getMultiplier(p.attr,c.attr);
    let dmg=Math.max(p.atk - c.def,0)*mult;
    c.hp=Math.max(c.hp - dmg,0);
    showEffect(p.emoji,compDiv.children[compIdx]);

    logDiv.textContent=`${p.name} ê³µê²©! ë°ë¯¸ì§€: ${dmg.toFixed(1)}. ì´ì œ ìƒëŒ€ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤.`;
    renderBattleDecks();
    selectedPlayerCardIndex=null;

    setTimeout(compAttack,800);
}

// ì»´í“¨í„° ê³µê²©
function compAttack(){
    if(playerDeck.filter(x=>x.hp>0).length===0||compDeck.filter(x=>x.hp>0).length===0){
        checkEnd(); return;
    }
    logDiv.textContent='ìƒëŒ€ ê³µê²© ì¤‘...';
    let cIdx=Math.floor(Math.random()*compDeck.length);
    while(compDeck[cIdx].hp<=0){
        cIdx=Math.floor(Math.random()*compDeck.length);
    }
    let c=compDeck[cIdx];
    let pIndices=playerDeck.map((x,i)=>x.hp>0? i : -1).filter(i=>i!==-1);
    let pIdx=pIndices[Math.floor(Math.random()*pIndices.length)];
    let p=playerDeck[pIdx];

    let mult=getMultiplier(c.attr,p.attr);
    let dmg=Math.max(c.atk - p.def,0)*mult;
    p.hp=Math.max(p.hp - dmg,0);
    showEffect(c.emoji,playerDiv.children[pIdx]);

    renderBattleDecks();
    setTimeout(checkEnd,500);
}

function checkEnd(){
    if(playerDeck.every(x=>x.hp<=0)){
        logDiv.textContent='íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤.';
        restartBtn.style.display='block';
        return;
    }
    if(compDeck.every(x=>x.hp<=0)){
        logDiv.textContent='ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!';
        restartBtn.style.display='block';
        return;
    }
    logDiv.textContent='ê³µê²©í•  ë‚´ ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.';
}

// íš¨ê³¼
function showEffect(emoji,targetEl){
    const eff=document.createElement('div');
    eff.className='effect';
    eff.textContent=emoji;
    document.body.appendChild(eff);
    const r=targetEl.getBoundingClientRect();
    eff.style.left=r.left+'px'; eff.style.top=r.top+'px';
    setTimeout(()=>eff.remove(),700);
    renderBattleDecks();
}

document.getElementById('ruleBtn').onclick=()=>{
    const ui=document.getElementById('ruleUI');
    ui.style.display=(ui.style.display==='none'?'block':'none');
};
document.getElementById('backBtn').onclick=()=>{ window.location.href='../';};
document.getElementById('restartBtn').onclick=()=>{ location.reload();};

cardPool=[...allCards];
renderCardPool();
</script>

</body>
</html>
