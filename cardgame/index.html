<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì „ëµ ì†ì„± ì¹´ë“œ ê²Œì„</title>
<style>
body {
    background: #0f0f0f;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
}
h1 { margin-bottom: 20px; }
#cardPool, #playerDeck, #opponentDeck {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
}
.card {
    width: 100px; height: 140px;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    background: #1c1c1c;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    user-select: none;
    perspective: 600px;
    position: relative;
    transition: transform 0.3s;
}
.card.flip .front { transform: rotateY(0deg); }
.card.flip .back { transform: rotateY(180deg); }
.front, .back {
    position: absolute;
    width: 100%; height: 100%;
    backface-visibility: hidden;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    border-radius: 10px;
    transition: transform 0.5s;
}
.front { transform: rotateY(180deg); background:#1c1c1c; }
.back { transform: rotateY(0deg); background:#2a2a2a; }
.card.retired { opacity:0.3; cursor:default; }
#log { min-height: 80px; margin-top: 20px; }
button { padding: 6px 12px; margin: 3px; cursor: pointer; }
#rulesModal {
    display:none;
    position:fixed; top:50%; left:50%;
    transform:translate(-50%, -50%);
    background:#1c1c1c; padding:15px;
    border-radius:10px;
    width:300px; text-align:left;
    z-index:10000;
}
#backBtn,#rulesBtn { position:fixed; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; z-index:9999; }
#backBtn{top:20px; left:20px; background:#0a84ff; color:white;}
#rulesBtn{top:20px; right:20px; background:#ff9500; color:white;}
.effect {
    position:absolute; font-size:24px; z-index:1000;
    transition: transform 0.7s linear, opacity 0.7s linear;
}
</style>
</head>
<body>

<h1>ì „ëµ ì†ì„± ì¹´ë“œ ê²Œì„</h1>
<button id="backBtn">&lt; ëŒì•„ê°€ê¸°</button>
<button id="rulesBtn">ê·œì¹™</button>

<div id="rulesModal">
<h3>ê²Œì„ ê·œì¹™</h3>
<p>1. ì¹´ë“œ í’€ì—ì„œ 5ì¥ ì„ íƒ â†’ ì „íˆ¬ ì‹œì‘<br>
2. ì†ì„± ìƒì„±: ğŸ”¥>ğŸŒ¿>â›°ï¸>âš”ï¸>ğŸŸ¤>ğŸ’§>ğŸ”¥<br>
3. ê³µê²©ë ¥ - ë°©ì–´ë ¥ Ã— ìƒì„± ë°°ìˆ˜ â†’ ìƒëŒ€ HP ê°ì†Œ<br>
4. ìƒëŒ€ 5ì¥ ëª¨ë‘ ë¦¬íƒ€ì´ì–´ â†’ ìŠ¹ë¦¬!</p>
<button onclick="closeRules()">ë‹«ê¸°</button>
</div>

<h3>ì¹´ë“œ í’€ (ë’¤ì§‘íŒ ìƒíƒœ)</h3>
<div id="cardPool"></div>

<h3>ë‚´ ë±</h3>
<div id="playerDeck"></div>

<h3>ìƒëŒ€ ë±</h3>
<div id="opponentDeck"></div>

<div id="log">ì¹´ë“œ í’€ì—ì„œ 5ì¥ì„ ì„ íƒí•˜ì„¸ìš”.</div>

<script>
const allCards=[
{name:'ê¸°ì‚¬',atk:8,def:5,hp:20,attr:'âš”ï¸ì² '},
{name:'ë§ˆë²•ì‚¬',atk:6,def:3,hp:15,attr:'ğŸ”¥ë¶ˆ'},
{name:'ìš©',atk:10,def:7,hp:25,attr:'ğŸ”¥ë¶ˆ'},
{name:'ë„ì ',atk:5,def:4,hp:18,attr:'ğŸŸ¤ë…¸ë§'},
{name:'ê¶ìˆ˜',atk:7,def:3,hp:16,attr:'ğŸŒ¿í’€'},
{name:'ì„±ì§ì',atk:4,def:6,hp:20,attr:'ğŸ’§ë¬¼'},
{name:'ëŠ‘ëŒ€',atk:6,def:4,hp:18,attr:'ğŸŒ¿í’€'},
{name:'ê±°ì¸',atk:9,def:8,hp:30,attr:'â›°ï¸ë•…'},
{name:'ì¢€ë¹„',atk:5,def:3,hp:22,attr:'ğŸŸ¤ë…¸ë§'},
{name:'ê³ ë¸”ë¦°',atk:4,def:2,hp:15,attr:'âš”ï¸ì² '},
{name:'ì •ë ¹',atk:6,def:5,hp:17,attr:'ğŸ’§ë¬¼'},
{name:'í•´ì ',atk:7,def:4,hp:19,attr:'ğŸ”¥ë¶ˆ'},
{name:'ë‹Œì',atk:8,def:3,hp:16,attr:'ğŸŸ¤ë…¸ë§'},
{name:'ì‚¬ì œ',atk:3,def:6,hp:18,attr:'ğŸŒ¿í’€'},
{name:'ì—˜í”„',atk:7,def:5,hp:20,attr:'ğŸŒ¿í’€'},
{name:'ë“œë˜ê³¤',atk:10,def:10,hp:35,attr:'ğŸ”¥ë¶ˆ'},
{name:'ë°”ëŒì •ë ¹',atk:5,def:5,hp:15,attr:'ğŸ’§ë¬¼'},
{name:'íŠ¸ë¡¤',atk:9,def:7,hp:28,attr:'â›°ï¸ë•…'},
{name:'ìœ ë ¹',atk:6,def:2,hp:15,attr:'ğŸŸ¤ë…¸ë§'},
{name:'ê³°',atk:8,def:6,hp:25,attr:'âš”ï¸ì² '}
];

const advantage={'ğŸ”¥ë¶ˆ':'ğŸŒ¿í’€','ğŸŒ¿í’€':'â›°ï¸ë•…','â›°ï¸ë•…':'âš”ï¸ì² ','âš”ï¸ì² ':'ğŸŸ¤ë…¸ë§','ğŸŸ¤ë…¸ë§':'ğŸ’§ë¬¼','ğŸ’§ë¬¼':'ğŸ”¥ë¶ˆ'};

let playerDeck=[], compDeck=[], turn=1;
const cardPoolDiv=document.getElementById('cardPool');
const playerDiv=document.getElementById('playerDeck');
const compDiv=document.getElementById('opponentDeck');
const logDiv=document.getElementById('log');

document.getElementById('backBtn').onclick=()=>{location.href='../';};
document.getElementById('rulesBtn').onclick=()=>{document.getElementById('rulesModal').style.display='block';};
function closeRules(){document.getElementById('rulesModal').style.display='none';}

// ì¹´ë“œ í’€ ìƒì„±
function initCardPool(){
    cardPoolDiv.innerHTML='';
    allCards.forEach((c,i)=>{
        const div=document.createElement('div');
        div.className='card flip';
        div.innerHTML=`<div class="front"></div><div class="back">${c.name}<br>ATK:${c.atk}<br>DEF:${c.def}<br>HP:${c.hp}<br>${c.attr}</div>`;
        div.onclick=()=>pickCard(i);
        cardPoolDiv.appendChild(div);
    });
}

function pickCard(index){
    if(playerDeck.length>=5) return;
    playerDeck.push({...allCards[index]});
    allCards.splice(index,1);
    renderPoolAndDeck();
    if(playerDeck.length===5) startBattle();
}

function renderPoolAndDeck(){
    cardPoolDiv.innerHTML='';
    allCards.forEach((c,i)=>{
        const div=document.createElement('div');
        div.className='card flip';
        div.innerHTML=`<div class="front"></div><div class="back">${c.name}<br>ATK:${c.atk}<br>DEF:${c.def}<br>HP:${c.hp}<br>${c.attr}</div>`;
        div.onclick=()=>pickCard(i);
        cardPoolDiv.appendChild(div);
    });
    renderDecks();
}

function renderDecks(){
    playerDiv.innerHTML=''; compDiv.innerHTML='';
    playerDeck.forEach(c=>{
        const div=document.createElement('div'); div.className='card flip';
        div.innerHTML=`<div class="front"></div><div class="back">${c.name}<br>${c.attr}<br>HP:${c.hp}</div>`;
        if(c.hp<=0) div.classList.add('retired');
        playerDiv.appendChild(div);
    });
    compDeck.forEach(c=>{
        const div=document.createElement('div'); div.className='card flip';
        div.innerHTML=`<div class="front"></div><div class="back">${c.name}<br>${c.attr}<br>HP:${c.hp}</div>`;
        if(c.hp<=0) div.classList.add('retired');
        compDiv.appendChild(div);
    });
}

// ì „íˆ¬ ì‹œì‘
function startBattle(){
    // ì»´í“¨í„° 5ì¥ ëœë¤
    let pool=[...allCards];
    for(let i=0;i<5;i++){
        let idx=Math.floor(Math.random()*pool.length);
        compDeck.push({...pool.splice(idx,1)[0]});
    }
    logDiv.textContent='ì „íˆ¬ ì‹œì‘! í”Œë ˆì´ì–´ ì¹´ë“œ í´ë¦­í•´ì„œ ê³µê²©!';
    cardPoolDiv.style.display='none';
}

// ê³µê²©/ì†ì„± ëª¨ì…˜
function showEffect(emoji, fromElem, toElem){
    const effect=document.createElement('div');
    effect.className='effect';
    effect.textContent=emoji;
    document.body.appendChild(effect);
    const fromRect=fromElem.getBoundingClientRect();
    const toRect=toElem.getBoundingClientRect();
    effect.style.left=fromRect.left + fromRect.width/2 + 'px';
    effect.style.top=fromRect.top + fromRect.height/2 + 'px';
    requestAnimationFrame(()=>{
        effect.style.transform=`translate(${toRect.left - fromRect.left}px, ${toRect.top - fromRect.top}px)`;
        effect.style.opacity='0';
    });
    setTimeout(()=>effect.remove(),700);
}

// í„´ ì§„í–‰
function playTurn(cardIndex){
    if(cardIndex>=playerDeck.length || playerDeck.length===0 || compDeck.length===0) return;

    const playerCard=playerDeck[cardIndex];
    const compIndex=Math.floor(Math.random()*compDeck.length);
    const compCard=compDeck[compIndex];

    // ì†ì„± ìƒì„± ë°°ìœ¨
    let dmgMultiplier=1;
    if(advantage[playerCard.attr]===compCard.attr) dmgMultiplier=1.5;
    else if(advantage[compCard.attr]===playerCard.attr) dmgMultiplier=0.5;

    const playerDmg=Math.max(playerCard.atk-compCard.def,0)*dmgMultiplier;
    const compDmg=Math.max(compCard.atk-playerCard.def,0)*dmgMultiplier;

    // ê³µê²©/ë°©ì–´ ëª¨ì…˜
    showEffect(playerCard.attr, playerDiv.children[cardIndex], compDiv.children[compIndex]);
    playerDiv.children[cardIndex].style.transform='translateY(-10px)';
    compDiv.children[compIndex].style.transform='translateY(10px)';
    setTimeout(()=>{
        playerDiv.children[cardIndex].style.transform='';
        compDiv.children[compIndex].style.transform='';
    },300);

    compCard.hp-=playerDmg; playerCard.hp-=compDmg;

    let msg=`í„´ ${turn}: ${playerCard.name} vs ${compCard.name}<br>`;
    msg+=`${playerCard.name}ê°€ ${playerDmg.toFixed(1)} ë°ë¯¸ì§€, ${compCard.name}ê°€ ${compDmg.toFixed(1)} ë°ë¯¸ì§€<br>`;

    if(compCard.hp<=0){ compDeck.splice(compIndex,1); msg+=`${compCard.name} ë¦¬íƒ€ì´ì–´!<br>`; }
    if(playerCard.hp<=0){ playerDeck.splice(cardIndex,1); msg+=`${playerCard.name} ë¦¬íƒ€ì´ì–´!<br>`; }

    logDiv.innerHTML=msg;
    renderDecks();
    turn++;

    if(playerDeck.length===0 || compDeck.length===0){
        let final='';
        if(playerDeck.length>compDeck.length) final='ìµœì¢… ìŠ¹ë¦¬!';
        else if(playerDeck.length<compDeck.length) final='ìµœì¢… íŒ¨ë°°!';
        else final='ë¬´ìŠ¹ë¶€!';
        logDiv.innerHTML+=`<br>ê²Œì„ ì¢…ë£Œ! ${final}`;
    }
}

// í”Œë ˆì´ì–´ ì¹´ë“œ í´ë¦­ -> í„´ ì‹¤í–‰
playerDiv.onclick=(e)=>{
    const cards=Array.from(playerDiv.children);
    const idx=cards.indexOf(e.target.closest('.card'));
    if(idx!==-1) playTurn(idx);
};

initCardPool();
</script>
</body>
</html>
