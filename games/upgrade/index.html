<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¬´ê¸° ê°•í™” ì‹œë®¬ë ˆì´í„°</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #111;
            color: #fff;
            font-family: Arial, sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #backBtn {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 8px 12px;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .box {
            width: 320px;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        button {
            width: 100%;
            padding: 10px;
            margin: 6px 0;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        #upgradeBtn { background: #3b82f6; color: white; }
        #sellBtn { background: #f59e0b; color: black; }
        #attendanceBtn { background: #16a34a; color: white; }
        #rescueBtn { background: #dc2626; color: white; }

        #gold { color: #facc15; margin: 6px 0; font-weight: bold; }
        #rate { color: #60a5fa; margin: 4px 0; font-size: 13px; }

        #log { min-height: 24px; margin: 10px 0; color: #facc15; }

        .collection {
            max-height: 120px;
            overflow-y: auto;
            background: #0f0f0f;
            padding: 6px;
            border-radius: 6px;
            font-size: 12px;
            margin-top: 10px;
            text-align: left;
        }

        .item {
            background: #222;
            margin-bottom: 4px;
            padding: 4px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

<button id="backBtn" onclick="goBack()">â† ë’¤ë¡œê°€ê¸°</button>

<div class="box">
    <h2 id="weaponName">ë‚¡ì€ ê²€</h2>
    <div id="weaponIcon" style="font-size:48px; margin: 6px 0;">ğŸ—¡ï¸</div>
    <div id="weaponLevel">+0</div>
    <div id="rate">ì„±ê³µ í™•ë¥ : 100%</div>
    <div id="gold">ğŸ’° 0 G</div>

    <button id="upgradeBtn" onclick="upgrade()">ê°•í™”í•˜ê¸° (20G)</button>
    <button id="sellBtn" onclick="sellWeapon()">ë¬´ê¸° íŒë§¤</button>
    <button id="attendanceBtn" onclick="checkAttendance()">ì¶œì„ ì²´í¬</button>
    <button id="rescueBtn" onclick="emergencyRescue()">ê¸´ê¸‰ ì§€ì› ë°›ê¸°</button>

    <div id="log">ê°•í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</div>

    <div class="collection" id="collection"></div>
</div>

<script>
    let level = 0;
    let gold = 0;

    const upgradeCost = 20;

    const stageNames = ["ë‚¡ì€", "ë‹¨ë‹¨í•œ", "ê°•ì² ", "ë¶ˆíƒ€ëŠ”", "ìš©ì˜"];
    const extras = ["ë‚ ì¹´ë¡œìš´", "ë¬µì§í•œ", "ë¹›ë‚˜ëŠ”", "ì €ì£¼ë°›ì€", "ì‹ ì„±í•œ", "ê´‘í­í•œ"];

    // === ë„ê° ì €ì¥ìš© Set ===
    let collectionSet = new Set(JSON.parse(localStorage.getItem("collection")) || []);

    // === ìµœì´ˆ ì ‘ì† ì‹œ 1000G ì§€ê¸‰ ===
    if (!localStorage.getItem("initGold")) {
        gold = 1000;
        localStorage.setItem("initGold", "true");
        localStorage.setItem("gold", gold);
    } else {
        gold = parseInt(localStorage.getItem("gold")) || 0;
    }

    function getWeaponName() {
        const stage = stageNames[Math.min(Math.floor(level / 5), stageNames.length - 1)];
        const extra = extras[level % extras.length];
        return level === 0 ? `${stage} ê²€` : `${stage} ${extra} ê²€`;
    }

    function getWeaponIcon() {
        if (level < 5) return "ğŸ—¡ï¸";
        if (level < 10) return "âš”ï¸";
        if (level < 15) return "ğŸ”¥âš”ï¸";
        return "ğŸ‘‘âš”ï¸";
    }

    // ê°•í™” ì„±ê³µ í™•ë¥ 
    function getSuccessRate() {
        if (level === 0) return 100;
        let rate = 100;
        for (let i = 1; i <= level; i++) {
            rate -= i;
        }
        return Math.max(rate, 5);
    }

    function upgrade() {
        if (gold < upgradeCost) {
            log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
            return;
        }

        gold -= upgradeCost;
        updateGold();

        const successRate = getSuccessRate();
        const r = Math.random() * 100;

        if (r <= successRate) {
            level++;
            log("ê°•í™” ì„±ê³µ! +1");
        } else {
            const boom = Math.random();
            if (boom < 0.05) {
                log("ğŸ’¥ ë¬´ê¸° íŒŒê´´! ìƒˆ ë¬´ê¸° ì§€ê¸‰");
                resetWeapon();
                return;
            } else {
                log("ê°•í™” ì‹¤íŒ¨â€¦ ë³€í™” ì—†ìŒ");
            }
        }

        updateWeapon();
    }

    function resetWeapon() {
        level = 0;
        updateWeapon();
    }

    function updateWeapon() {
        const name = getWeaponName();

        document.getElementById("weaponName").innerText = name;
        document.getElementById("weaponLevel").innerText = "+" + level;
        document.getElementById("rate").innerText = `ì„±ê³µ í™•ë¥ : ${getSuccessRate()}%`;
        document.getElementById("weaponIcon").innerText = getWeaponIcon();

        addToCollection(name);
    }

    function addToCollection(name) {
        if (collectionSet.has(name)) return;

        collectionSet.add(name);
        localStorage.setItem("collection", JSON.stringify([...collectionSet]));

        const div = document.createElement("div");
        div.className = "item";
        div.innerText = name;
        document.getElementById("collection").appendChild(div);
    }

    function loadCollection() {
        const saved = JSON.parse(localStorage.getItem("collection")) || [];
        const box = document.getElementById("collection");

        box.innerHTML = "";

        saved.forEach(name => {
            const div = document.createElement("div");
            div.className = "item";
            div.innerText = name;
            box.appendChild(div);
        });
    }

    function sellWeapon() {
        if (level === 0) {
            log("ê¸°ë³¸ ë¬´ê¸°ëŠ” íŒë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        const price = level * 30;
        gold += price;
        log(`+${level} ë¬´ê¸°ë¥¼ ${price}Gì— íŒë§¤í–ˆìŠµë‹ˆë‹¤.`);
        updateGold();
        resetWeapon();
    }

    function updateGold() {
        document.getElementById("gold").innerText = `ğŸ’° ${gold} G`;
        localStorage.setItem("gold", gold);
    }

    function checkAttendance() {
        const today = new Date().toDateString();
        const last = localStorage.getItem("attendance");

        if (last === today) {
            log("ì˜¤ëŠ˜ì€ ì´ë¯¸ ì¶œì„í–ˆìŠµë‹ˆë‹¤.");
            return;
        }

        gold += 100;
        updateGold();
        localStorage.setItem("attendance", today);
        log("ì¶œì„ ë³´ìƒ 100G ì§€ê¸‰!");
    }

    function emergencyRescue() {
        const used = localStorage.getItem("emergencyUsed");

        if (used === "true") {
            log("ì´ë¯¸ ê¸´ê¸‰ ì§€ì›ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.");
            return;
        }

        const reward = 500;
        gold += reward;
        updateGold();

        localStorage.setItem("emergencyUsed", "true");
        log(`ğŸ†˜ ì‹œìŠ¤í…œ ë³µêµ¬ ë³´ìƒ ${reward}G ì§€ê¸‰!`);
        checkEmergencyButton();
    }

    function checkEmergencyButton() {
        const used = localStorage.getItem("emergencyUsed");
        if (used === "true") {
            document.getElementById("rescueBtn").style.display = "none";
        }
    }

    function log(msg) {
        document.getElementById("log").innerText = msg;
    }

    function goBack() {
        alert("ë©”ì¸ í˜ì´ì§€ëŠ” ë‚˜ì¤‘ì— ì—°ê²°í•˜ì ğŸ˜");
    }

    // === ìµœì´ˆ ì‹¤í–‰ ===
    updateWeapon();
    updateGold();
    checkEmergencyButton();
    loadCollection();
</script>

</body>
</html>


